<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.svg" type="image/x-icon">
    <title>Ocho SPA Documentation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="code.css">
</head>
<body>
    <div class="content">
        <h1>SPA with API and Dynamic Routing</h1>
        <span>GitHub Repo: <a href="https://github.com/OchoKOM/ocho-spa" class="string">https://github.com/OchoKOM/ocho-spa</a></span>
        <p>This project is a single-page web application (SPA) using PHP for the backend and JavaScript for the frontend. It allows for dynamic page loading and route management via an API.</p>
    
        <h2>Project Structure</h2>
        <pre><code><span class="tag-name">root/</span>
    ‚îú‚îÄ <span class="identifier">.htaccess</span>                <span class="comment"># Apache configuration for clean URLs</span>
    ‚îú‚îÄ <span class="identifier">router.php</span>               <span class="comment"># Alternative router for the built-in PHP server</span>
    ‚îú‚îÄ <span class="tag-name">api/</span>
    ‚îÇ  ‚îú‚îÄ <span class="identifier">get-page.php</span>          <span class="comment"># Route handler</span>
    ‚îÇ  ‚îú‚îÄ <span class="identifier">json-response.php</span>     <span class="comment"># Helper for JSON responses</span>
    ‚îÇ  ‚îî‚îÄ <span class="identifier">spa-helpers.php</span>       <span class="comment"># Utility functions for the SPA</span>
    ‚îú‚îÄ <span class="tag-name">app/</span>
    ‚îÇ  ‚îú‚îÄ <span class="tag-name">css/</span>
    ‚îÇ  ‚îÇ  ‚îî‚îÄ <span class="identifier">style.css</span>          <span class="comment"># Global styles</span>
    ‚îÇ  ‚îú‚îÄ <span class="tag-name">js/</span>
    ‚îÇ  ‚îÇ  ‚îú‚îÄ <span class="identifier">app.js</span>             <span class="comment"># Main SPA logic</span>
    ‚îÇ  ‚îÇ  ‚îî‚îÄ <span class="identifier">ocho-api.js</span>        <span class="comment"># API client with error handling</span>
    ‚îÇ  ‚îî‚îÄ <span class="tag-name">uploads/</span>              <span class="comment"># File storage</span>
    ‚îú‚îÄ <span class="identifier">index.php</span>                <span class="comment"># Main entry point</span>
    ‚îú‚îÄ <span class="tag-name">pages/</span>                   <span class="comment"># Page content</span>
    ‚îÇ  ‚îú‚îÄ <span class="tag-name">about/</span>
    ‚îÇ  ‚îÇ  ‚îú‚îÄ <span class="identifier">metadata.json</span>      <span class="comment"># Specific metadata</span>
    ‚îÇ  ‚îÇ  ‚îî‚îÄ <span class="identifier">page.php</span>           <span class="comment"># HTML content</span>
    ‚îÇ  ‚îú‚îÄ <span class="tag-name">courses/</span>
    ‚îÇ  ‚îÇ  ‚îú‚îÄ <span class="tag-name">dir/</span>
    ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ <span class="tag-name">dir-1/</span>          <span class="comment"># Subdirectories</span>
    ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ <span class="tag-name">dir-2/</span>
    ‚îÇ  ‚îÇ  ‚îî‚îÄ <span class="identifier">page.php</span>
    ‚îÇ  ‚îú‚îÄ <span class="identifier">layout.php</span>            <span class="comment"># Main layout</span>
    ‚îÇ  ‚îú‚îÄ <span class="identifier">page.php</span>              <span class="comment"># Default layout</span>
    ‚îÇ  ‚îî‚îÄ <span class="comment">**other pages here**</span>  <span class="comment"># Add your pages here</span>
    ‚îî‚îÄ <span class="identifier">README.md</span>                <span class="comment"># Documentation</span></code></pre>
    
        <h2>File Details</h2>

        <ul>
            <li><strong><span class="identifier">.htaccess</span></strong> : Apache configuration to redirect requests to <span class="identifier">index.php</span>.<br>
            <strong>Alternative</strong> : <span class="identifier">router.php</span> replaces this functionality for the built-in PHP server.</li>
            
            <li><strong><span class="identifier">router.php</span></strong> : PHP router to emulate the behavior of <code>.htaccess</code> :
                <ul>
                    <li>Handles SPA routing to <code>index.php</code></li>
                    <li>Serves static files (CSS/JS/images)</li>
                    <li>Applies automatic extensions (<code>.php</code>, <code>.js</code>)</li>
                    <li>Handles custom errors (403, 404, 500)</li>
                </ul>
            </li>
            
            <li><strong><span class="identifier">api/get-page.php</span></strong> : PHP script to resolve routes and return the HTML content of pages.</li>
            <li><strong><span class="identifier">api/json-response.php</span></strong> : PHP function to send responses in JSON format.</li>
            <li><strong><span class="identifier">api/spa-helpers.php</span></strong> : Utility functions for SPA redirection management.</li>
            <li><strong><span class="identifier">app/css/style.css</span></strong> : Main style file.</li>
            <li><strong><span class="identifier">app/js/app.js</span></strong> : JavaScript script for dynamic navigation.</li>
            <li><strong><span class="identifier">app/js/ocho-api.js</span></strong> : HTTP client with error handling.</li>
            <li><strong><span class="identifier">index.php</span></strong> : Main entry point of the application.</li>
            <li><strong><span class="identifier">pages/</span></strong> : Directory containing all the pages of the application.</li>
        </ul>
        <h2>Features</h2>
        <h3>Multi-Environment Routing</h3>
        <ul>
            <li><strong>Apache</strong> : Use of <code>.htaccess</code> in production</li>
            <li><strong>PHP Server</strong> : Use of <code>router.php</code> in development</li>
        </ul>
        <pre><code><span class="keymethod">&lt;?php</span>
<span class="comment">// Handling automatic extensions</span>
<span class="keyword">if</span> (<span class="method">file_exists</span>(<span class="identifier">$phpFile</span>)) {
    <span class="method">include</span>(<span class="identifier">$phpFile</span>); <span class="comment">// Ex: /about ‚Üí /about.php</span>
}</code></pre>

<h3>Main Features</h3>
        <ul>
            <li><strong>Dynamic Routing</strong> via <span class="identifier">api/get-page.php</span></li>
            <li><strong>History Navigation</strong> with the History API</li>
            <li><strong>Structured JSON Responses</strong></li>
            <li><strong>Intelligent Redirection System</strong></li>
        </ul>
    
        <h2>Installation</h2>
        <ol>
            <li>Clone the repository:
                <pre><code><span class="keyword">git</span> <span class="tag">clone</span> <span class="string">https://github.com/OchoKOM/ocho-spa</span></code></pre>
            </li>
            <li>
                <strong>Configuration</strong> :
                <ul>
                    <li>
                        <h3>With Apache</h3>
                        <div>
            <pre><code><span class="keyword">a2enmod</span> <span class="tag">rewrite</span> && <span class="tag">systemctl</span> restart apache2</code></pre>
    
            <h4>VirtualHost Configuration</h4>
            <pre><code class="language-apache"><span class="vhost-tag">&lt;VirtualHost *<span class="identifier">:80</span>&gt;</span>
    <span class="identifier">DocumentRoot</span> /path/to/ocho-spa
    <span class="identifier">ServerName</span>  localhost
    <span class="vhost-tag">&lt;Directory <span class="string">"/path/to/ocho-spa"</span>&gt;</span>
        <span class="identifier">AllowOverride</span> All
        <span class="identifier">Require</span> all granted
    <span class="vhost-tag">&lt;/Directory&gt;</span>
<span class="vhost-tag">&lt;/VirtualHost&gt;</span>
</code></pre>
                        </div>
                    </li>
                    <li>
                        <h3>With Local Development Servers (WAMP, XAMPP, etc.)</h3>
                        <div>
                            <ul>
                                <li>Place the project in your web server (e.g., <span class="string">htdocs</span> for XAMPP or <span class="string">www</span> for WAMP).</li>
                                <li>Configure a VirtualHost (recommended) to point directly to the project directory.</li>
                                <li>Access the application via your browser at <span class="string">http://localhost/</span> or the address of your VirtualHost.</li>
                            </ul>
                            <div class="note">
                                <strong>Important Note:</strong> The application requires a root configuration (e.g., <span class="string">http://localhost</span>).<br>
                                Subdirectories may cause routing issues.
                            </div>
                        </div>
                    </li>
                    <li>
                        <h3>With Built-in PHP Server</h3>
                        <ul>
                            <li>
                                <div>Open the project folder in the terminal</div>
                                <pre><code class="language-bash"><span class="keyword">cd</span> <span class="tag">ocho-spa</span></code></pre>
                            </li>
                            <li>
                                <div>Serve the file <span class="identifier">router.php</span></div>
                                <pre><code class="language-bash"><span class="keyword">php</span> <span class="property">-S</span> localhost:<span class="number">4000</span> router.php</code></pre>
                            </li>

                        </u>
                    </li>
                </ul>
            </li>
        </ol>
        <h2>Technical Notes</h2>
        <div class="technical-notes">
            <table class="">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Apache</th>
                        <th>Built-in PHP</th>
                        <th>Local Development Servers (WAMP, XAMPP, etc.)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Redirection Management</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td>Support for Subdirectories</td>
                        <td>‚úÖ</td>
                        <td>‚ö†Ô∏è Limited</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td>Performance</td>
                        <td>‚úÖ Optimized</td>
                        <td>‚ö†Ô∏è Development</td>
                        <td>‚ö†Ô∏è Depends on configuration</td>
                    </tr>
                    <tr>
                        <td>Interface</td>
                        <td>üîß Command line, Manual configuration</td>
                        <td>üñ•Ô∏è No interface (CLI execution only)</td>
                        <td>üåê Web Interface + Graphical Manager</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>Usage</h2>
        <ul>
            <li><strong>Pages</strong> : Add folders in <span class="identifier">pages/</span> for each page of the application. Insert a <span class="identifier">page.php</span> or <span class="identifier">layout.php</span> file for the HTML content.</li>
            <li><strong>Navigation</strong> : Click on links to navigate. Pages will load dynamically without a full reload.</li>
            <li><strong>API</strong> : API requests are managed by <span class="identifier">OchoClient</span> in <span class="identifier">ocho-api.js</span>. For more information visit the repo <a href="https://github.com/OchoKOM/xhr" class="string">https://github.com/OchoKOM/xhr</a></li>
            <li><strong>Redirections</strong> : Use the function <span class="tag-name">spa_redirect()</span> to redirect to another route.</li>
        </ul>
        <h2>Configurations</h2>
        <h3>Page Structure</h3>
        <ul>
            <li>
                <strong>Adding Pages</strong>
                <div>In the <span class="identifier">pages/</span> directory, you add directories that will contain your pages</div>
                <strong class="identifier">Structure:</strong>
                <pre><code><span class="tag-name">pages/</span> <span class="comment"># Accessible via the path / (the root)</span>
‚îú‚îÄ <span class="identifier">metadata.json</span> <span class="comment"># Default metadata</span>
‚îú‚îÄ <span class="identifier">page.php</span> <span class="comment"># Main content</span>
‚îú‚îÄ <span class="identifier">layout.php</span> <span class="comment"># Default layout</span>
‚îî‚îÄ <span class="tag-name">your-directory/</span> <span class="comment"># Accessible via the path /your-directory</span>
   ‚îú‚îÄ <span class="identifier">metadata.json</span> <span class="comment"># Page metadata</span>
   ‚îú‚îÄ <span class="identifier">page.php</span> <span class="comment"># HTML content of the page</span>
   ‚îú‚îÄ <span class="identifier">layout.php</span> <span class="comment"># Page layout (optional)</span>
   ‚îî‚îÄ <span class="tag-name">sub-folder/</span>
     ‚îî‚îÄ <span class="identifier">page.php</span> <span class="comment"># The metadata and layout of the parent will also apply here</code></pre>
            </li>
            <li>
                <strong>File Priority</strong>
                <ol>
                    <li><span class="identifier">page.php</span> in the current directory</li>
                    <li><span class="identifier">layout.php</span> in the nearest parent directory</li>
                    <li>List of subdirectories (if no file is found)</li>
                </ol>

            </li>
            <li>

                    <strong>Dynamic Layouts</strong>
                    <div>Each directory can contain a <span class="identifier">layout.php</span> file with this structure :</div>
        <pre><code><span class="tag">&lt;<span class="tag-name">header</span>&gt;</span><span class="comment">&lt;!-- Navigation --&gt;</span><span class="tag">&lt;/<span class="tag-name">header</span>&gt;</span>
<span class="tag">&lt;<span class="tag-name">main</span>&gt;</span>
<span class="keymethod">&lt;?php</span> 
    <span class="keyword">echo</span> <span class="identifier">$pageContent</span>; <span class="comment">// Page contents</span> 
<span class="keymethod">?&gt;</span>
<span class="tag">&lt;/<span class="tag-name">main</span>&gt;</span>
<span class="tag">&lt;<span class="tag-name">footer</span>&gt;</span><span class="comment">&lt;!-- Footer --&gt;</span><span class="tag">&lt;/<span class="tag-name">footer</span>&gt;</span></code></pre>
                <ul>
                    <li>The variable <span class="identifier">$pageContent</span> displays the contents of the <span class="identifier">page.php</span> in the current directory and subdirectories that do not have a <span class="identifier">layout.php</span></li>
                    <li>
                        <div>The layout file can have page behaviour by adding an <span class="identifier">"as page"</span> keyword on top of the file like on the example below:</div>
                        <pre><code><span class="keymethod">&lt;?php</span> 
    <span class="string">"as page"</span>; <span class="comment">// Keystring to act like page.</span>
<span class="keymethod">?&gt;</span>
&lt;<span class="tag-name">div</span> <span class="identifier">class</span>=<span class="string">"page"</span>&gt;
<span class="keymethod">&lt;?php</span> 
    <span class="keyword">echo</span> <span class="identifier">$pageContent</span>; <span class="comment">// Page contents (optional)</span>
<span class="keymethod">?&gt;</span>
    <span class="tag">&lt;<span class="tag-name">h1</span>&gt;</span>Some layout with page behaviour<span class="tag">&lt;/<span class="tag-name">h1</span>&gt;</span>
<span class="tag">&lt;/<span class="tag-name">div</span>&gt;</span>
</code></pre>
                    </li>
                </ul>
            </li>
            <li>

                <strong>Hierarchical Metadata System</strong>
                <div>Each directory can contain a <span class="identifier">metadata.json</span> file with this structure:</div>
                <div>
                    <pre><code>{
    <span class="identifier">"title"</span>: <span class="string">"Page Title"</span>,
    <span class="identifier">"description"</span>: <span class="string">"Meta description"</span>,
    <span class="identifier">"styles"</span>: [<span class="string">"/path/to/style.css"</span>, <span class="string">"/path/to/style-2.css"</span>]
}</code></pre>
                </div>
            
                <ul>
                    <li>Titles and descriptions are inherited from parent directories.</li>
                    <li>
                        <strong>Style Management</strong>
                        <ul>
                            <li>Stylesheets are loaded dynamically via metadata.</li>
                            <li>They are applied hierarchically (global ‚Üí specific).</li>
                            <li>Styles are refreshed on each navigation.</li>
                        </ul>
                        <div>Place the <span class="identifier">metadata.json</span> file in the directory of your page that needs to apply the styles:</div>
                        <pre><code>{
    <span class="identifier">"title"</span>: <span class="string">"Styles"</span>,
    <span class="identifier">"description"</span>: <span class="string">"Page with style"</span>,
    <span class="identifier">"styles"</span>: [<span class="string">"/path/to/style.css"</span>, <span class="string">"/path/to/style-2.css"</span>]
}</code></pre>
                </li>
                </ul>
            </li>
        </ul>

        <h3>Dynamic Loading with API</h3>
            
        <h4>JSON Responses from <span class="identifier">get-page.php</span></h4>
        <div>You can manage this response with your own logic or use <span class="key">apiClient</span> as explained below</div>
        <pre><code>{
    <span class="identifier">"content"</span>: <span class="string">"&lt;h1&gt;Welcome&lt;/h1&gt;"</span>,
    <span class="identifier">"metadata"</span>: {
    <span class="identifier">"title"</span>: <span class="string">"Styles"</span>,
    <span class="identifier">"description"</span>: <span class="string">"Page with style"</span>,
    },
    <span class="identifier">"styles"</span>: [<span class="string">"/path/to/style.css"</span>, <span class="string">"/path/to/style-2.css"</span>]
}</code></pre>
<div class="advanced-usage">
    <h4>Redirection Management</h4>
    <p>Example of redirection in a <span class="identifier">page.php</span> or <span class="identifier">layout.php</span> file:</p>
<pre><code><span class="keymethod">&lt;?php</span>
<span class="keyword">if</span> (!<span class="method">user_is_logged_in</span>()) { <span class="comment">// Your redirection condition</span>
<span class="method">spa_redirect</span>(<span class="string">'/login'</span>); <span class="comment">// Redirect to the login page</span>
}</code></pre>
</div>
<div class="advanced-usage">
    <p>The server response looks like this (with a status <span class="number">302</span> and redirect url in headers):</p>
<pre><code>{
    <span class="identifier">"content"</span>: <span class="string">"&lt;div class='spa-redirect'&gt;Redirection...&lt;/div&gt;"</span>,
    <span class="identifier">"metadata"</span>: {
        <span class="identifier">"title"</span>: <span class="string">"Redirection"</span>
    },
    <span class="identifier">"styles"</span>: [],
}
</code></pre>
<p>The redirection url is in the header with the key <span class="string">"X-SPA-Redirect"</span>. <br> Use your own logic or follow the instructions below.</p>
</div>
<strong>Usage of <span class="identifier">apiClient</span> :</strong>
<div>Import <span class="identifier">apiClient</span> from <span class="identifier">ocho-api.js</span> :</div>
<pre><code><span class="keyword">import</span> { <span class="keymethod">apiClient</span> } <span class="keyword">from</span> <span class="string">"/app/js/ocho-api.js"</span>;</code></pre>
            <ul>
                <li>
                    <strong>Method 1:</strong>
                    <div>
                        <pre><code><span class="identifier">apiClient</span>
    .<span class="method">get</span>(<span class="string">`/api/get-page?route=/path/to/page`</span>)
    .<span class="method">then</span>((<span class="identifier">response</span>) =&gt; {
        <span class="identifier">console</span>.<span class="method">log</span>(<span class="identifier">response</span>); <span class="comment">// API response</span>
    })</code></pre>
                    </div>
                </li>
                <li>
                    <strong>Method 2:</strong>
                    <div>
                        <pre><code><span class="keyword">const</span> <span class="identifier">response</span> = <span class="keyword">await</span> <span class="identifier">apiClient</span>.<span class="method">get</span>(<span class="string">`/api/get-page.php?route=/path/to/page`</span>);

<span class="identifier">console</span>.<span class="method">log</span>(<span class="identifier">response</span>); <span class="comment">// API response</span> </code></pre>
                    </div>
                </li>
            </ul>
            <strong>Structure of the <span class="identifier">apiClient</span> response:</strong>
            <pre><code>{
    <span class="keymethod">data</span>: {
        <span class="keymethod">content</span>: <span class="string">"&lt;h1&gt;Content of your page&lt;/h1&gt;"</span>,
        <span class="keymethod">metadata</span>: {
            <span class="keymethod">title</span>: <span class="string">"Page Title"</span>,
            <span class="keymethod">description</span>: <span class="string">"Content of meta description"</span>
        },
        <span class="keymethod">styles</span>: [
            <span class="string">"/path/to/style-1.css"</span>,
            <span class="string">"/path/to/style-2.css"</span>,
        ]
    },
    <span class="keymethod">status</span>: <span class="string">200</span>,
    <span class="keymethod">statusText</span>: <span class="string">"OK"</span>,
    <span class="keymethod">headers</span>: {
        <span class="string">"X-header-1"</span>: <span class="string">"Header-1-string"</span>,
        <span class="string">"X-header-2"</span>: <span class="string">"Header-2-string"</span>,
    }
}</code></pre>
You can adapt according to your own logic or follow the instructions below: 
<ul>
    <li>
        <div>
            <div><strong>Navigation:</strong> use this function to manage dynamic navigation.</div>
    <pre>
<code><span class="keyword">async</span> <span class="keyword">function</span> <span class="method">navigate</span>(<span class="identifier">route</span>) {
    <span class="keyword">const</span> <span class="identifier">destination</span> = <span class="string">`${route}`</span>;
    <span class="keyword">const</span> <span class="identifier">response</span> = <span class="keyword">await</span> <span class="method">fetchPageContent</span>(<span class="identifier">destination</span>);
    
    
    <span class="comment">// Update the page content</span>
    <span class="identifier">document</span>.<span class="method">getElementById</span>(<span class="string">"app"</span>).<span class="keymethod">innerHTML</span> = <span class="identifier">response</span>.<span class="keymethod">content</span>;
    
    
    <span class="comment">// Update the metadata</span>
    <span class="identifier">document</span>.<span class="keymethod">title</span> = <span class="identifier">response</span>.<span class="keymethod">metadata</span>.<span class="keymethod">title</span> || <span class="string">"Title"</span>;
    <span class="keyword">const</span> <span class="identifier">metaDescription</span> = <span class="identifier">document</span>.<span class="method">querySelector</span>(<span class="string">'meta[name="description"]'</span>);
    <span class="keyword">if</span> (<span class="identifier">metaDescription</span>) {
        <span class="identifier">metaDescription</span>.<span class="keymethod">content</span> = <span class="identifier">response</span>.<span class="keymethod">metadata</span>.<span class="keymethod">description</span> || <span class="string">""</span>;
    }
    
    <span class="comment">Update the styles</span>
    <span class="keyword">const</span> <span class="identifier">exclusionList</span> = [];
    <span class="keyword">const</span> <span class="identifier">newStyles</span> = <span class="identifier">response</span>.<span class="keymethod">styles</span> ?? [];
    
    <span class="keyword">const</span> <span class="identifier">existingStyles</span> = <span class="identifier">document</span>.<span class="method">querySelectorAll</span>(<span class="string">"link[data-dynamic-css]"</span>);
    <span class="identifier">existingStyles</span>.<span class="method">forEach</span>((<span class="identifier">style</span>) =&gt; {
        <span class="keyword">const</span> <span class="identifier">sameHref</span> = <span class="identifier">newStyles</span>.<span class="method">some</span>((<span class="identifier">s</span>) =&gt; <span class="identifier">s</span> === <span class="identifier">style</span>.<span class="method">getAttribute</span>(<span class="string">"href"</span>));

        <span class="identifier">sameHref</span> &amp;&amp; <span class="identifier">exclusionList</span>.<span class="method">push</span>(<span class="identifier">style</span>.<span class="method">getAttribute</span>(<span class="string">"href"</span>));
        !<span class="identifier">sameHref</span> &amp;&amp; <span class="identifier">style</span>.<span class="method">remove</span>();
    });
    
    
    <span class="identifier">newStyles</span>.<span class="method">forEach</span>((<span class="identifier">styleUrl</span>) =&gt; {
        <span class="keyword">if</span> (!<span class="identifier">exclusionList</span>.<span class="method">includes</span>(<span class="identifier">styleUrl</span>)) {
            <span class="keyword">const</span> <span class="identifier">link</span> = <span class="identifier">document</span>.<span class="method">createElement</span>(<span class="string">"link"</span>);
            <span class="identifier">link</span>.<span class="keymethod">rel</span> = <span class="string">"stylesheet"</span>;

            <span class="identifier">link</span>.<span class="keymethod">href</span> = <span class="identifier">styleUrl</span>;

            <span class="identifier">link</span>.<span class="method">setAttribute</span>(<span class="string">"data-dynamic-css"</span>, <span class="string">"true"</span>);

            <span class="identifier">document</span>.<span class="keymethod">head</span>.<span class="method">appendChild</span>(<span class="identifier">link</span>);
        }
    });
    
    
    <span class="identifier">history</span>.<span class="method">pushState</span>({<span class="keymethod"> route </span>}, <span class="string">""</span>, <span class="identifier">destination</span>);
}</code>
    </pre>
        </div>
    </li>
    <li>
        <div><strong>Page content and redirections:</strong> use this function </div>
        
<div>
    <pre>
<code><span class="keyword">async</span> <span class="keyword">function</span> <span class="method">fetchPageContent</span>(<span class="identifier">route</span>) {
    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="method">Promise</span>(<span class="keyword">async</span> (<span class="identifier">resolve</span>) =&gt; {
    <span class="keyword">try</span> {
        <span class="keyword">const</span> <span class="identifier">response</span> = <span class="keyword">await</span> <span class="identifier">apiClient</span>.<span class="method">get</span>(<span class="string">`./api/get-page?route=${route}`</span>);
    
       <span class="comment">// Modify the redirection handling part:</span>
       <span class="keyword">if</span> (<span class="identifier">response</span>.<span class="keymethod">status</span> &gt;= <span class="number">300</span> &amp;&amp; <span class="identifier">response</span>.<span class="keymethod">status</span> &lt; <span class="number">400</span>) {
            <span class="keyword">const</span> <span class="identifier">location</span> = <span class="identifier">response</span>.<span class="keymethod">headers</span>[<span class="string">"x-spa-redirect"</span>] || <span class="identifier">response</span>.<span class="keymethod">data</span>.<span class="keymethod">location</span>;
    
    
        <span class="keyword">if</span> (<span class="identifier">location</span>) {
            <span class="method">navigate</span>(<span class="identifier">location</span>);
            <span class="keyword">return</span>;
        }

        <span class="identifier">console</span>.<span class="method">error</span>(<span class="string">"Redirection error"</span>);
        <span class="identifier">console</span>.<span class="method">log</span>(<span class="identifier">response</span>);
    
    
        <span class="method">resolve</span>({<span class="keymethod">
            content</span>: <span class="string">`
            &lt;h1&gt ;Error in redirection&lt;/h1&gt;
            &lt;p&gt;See the console for more details.&lt;/p&gt;
            `</span>,<span class="keymethod">
            metadata</span>: {<span class="keymethod"> title</span>: <span class="string">"Loading Error"</span> },<span class="keymethod">
            styles</span>: [],
        });
       }
        <span class="keyword">if</span> (!<span class="identifier">response</span>.<span class="keymethod">data</span>.<span class="keymethod">content</span>) {
                <span class="identifier">console</span>.<span class="method">warn</span>(<span class="string">"The response is not valid data: \n"</span>, <span class="identifier">response</span>.<span class="keymethod">data</span>);
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="method">Error</span>(<span class="string">"No valid data in the response."</span>);
        }
        <span class="method">resolve</span>(<span class="identifier">response</span>.<span class="keymethod">data</span>);
    } <span class="keyword">catch</span> (<span class="identifier">error</span>) {
       <span class="identifier">console</span>.<span class="method">error</span>(<span class="identifier">error</span>);
       <span class="comment">// Update the DOM</span>
       <span class="method">resolve</span>({<span class="keymethod">
            content</span>: <span class="string">`
            &lt;h1&gt;Page loading error&lt;/h1&gt;
            &lt;p&gt;See the console for more details.&lt;/p&gt; `</span>,
            <span class="keymethod">
            metadata</span>: {<span class="keymethod"> title</span>: <span class="string">"Loading Error"</span> },<span class="keymethod">
            styles</span>: [],
        });
    }
}</code>
    </pre>
</div>
    </li>
</ul>
    <h2>Advanced Configuration</h2>
        <pre><code><span class="identifier">RewriteEngine</span> <span class="string">On</span>
    
<span class="comment"># Exclusion of assets and API</span>
<span class="identifier">RewriteCond</span> <span class="string">%{REQUEST_URI}</span> !^/api/ [NC]
<span class="identifier">RewriteCond</span> <span class="string">%{REQUEST_URI}</span> !^/app/ [NC]
<span class="identifier">RewriteCond</span> <span class="string">%{REQUEST_FILENAME}</span> !-f
<span class="identifier">RewriteCond</span> <span class="string">%{REQUEST_FILENAME}</span> !-d
<span class="identifier">RewriteRule</span> ^ index.php [L]</code></pre>
        <h2>Best Practices</h2>
        <ul>
            <li>Organize styles by functionality</li>
            <li>Use metadata to improve SEO</li>
            <li>Structure layouts modularly</li>
            <li>Validate JSON files with:
                <pre><code><span class="keyword">php</span> <span class="property">-l</span> metadata.json</code></pre>
            </li>
        </ul>
    
        <h2>Contribute</h2>
        <p>Contributions are welcome. Open a <span class="identifier">pull request</span> or an <span class="identifier">issue</span> to discuss changes.</p>
    
        <h2>License</h2>
        <p>This project is licensed under <span class="identifier">MIT</span>. See the <span class="identifier">LICENSE</span> file for details.</p>
    </div>
</body>
</html>